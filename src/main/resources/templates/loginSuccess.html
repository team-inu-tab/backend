<!DOCTYPE html>
<html lang="ko-KR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Success</title>
</head>

<body>
    <h1>login Success</h1>
    <h5>ë¡œê·¸ì¸ ì„±ê³µ í›„ refresh í•„ìˆ˜!!</h5>
    <button onclick="getHello()">get hello</button>
    <button onclick="refresh()" style="color: orange;">refresh</button>
    <button onclick="logout()" style="color: red;">logout</button>
    <h3>ê°œì¸ ì •ë³´ ì €ì¥ API</h3>
    <button onclick="storeUserInfo()">store student info</button>
    <button onclick="storeWorkerInfo()">store worker info</button>
    <h3>ë©”ì¼ ì¡°íšŒ API</h3>
    <button onclick="getReceivedEmails()">get received emails</button>
    <button onclick="getSentEmails()">get sent emails</button>
    <button onclick="getSelfEmails()">get self emails</button>
    <button onclick="getImportantEmails()">get important emails</button>
    <button onclick="getScheduledEmails()">get scheduled emails</button>
    <button onclick="getDraftEmails()">get draft emails</button>
    <h3>íŒŒì¼ ê´€ë ¨ API</h3>
    <div>
        <h5>íŒŒì¼ ì €ì¥ í…ŒìŠ¤íŠ¸ API(íŒŒì¼ ì €ì¥ ì´ë©”ì¼ idëŠ” 1ë¡œ ë†“ìŒ)</h5>
        <input id="fileInput" type="file">
        <button onclick="storeFile()">submit</button>
    </div>
    <br />
    <div>
        <h5>íŒŒì¼ ì¡°íšŒ API</h5>
        <input id="emailId" type="number" placeholder="ì´ë©”ì¼ id">
        <input id="fileName" type="text" placeholder="íŒŒì¼ ì´ë¦„">
        <button onclick="getFile()">get file</button>
    </div>
    <br />
    <div>
        <h5>ë©”ì¼ ë³´ë‚´ê¸°</h5>
        <input id="toEmail" type="email" placeholder="ë°›ëŠ” ì‚¬ëŒ ì´ë©”ì¼">
        <input id="subject" type="text" placeholder="ì œëª©">
        <textarea id="body" placeholder="ì´ë©”ì¼ ë‚´ìš©"></textarea>
        <button onclick="sendEmail()">ë©”ì¼ ë³´ë‚´ê¸°</button>
    </div>
    <br>
    <script>
        let accessToken = "";

        async function getDraftEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/draft', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ì„ì‹œ ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ì„ì‹œ ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ì„ì‹œ ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function getScheduledEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/schedule', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ì˜ˆì•½ ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ì˜ˆì•½ ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ì˜ˆì•½ ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function getImportantEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/important', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ì¤‘ìš” ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ì¤‘ìš” ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ì¤‘ìš” ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function getSelfEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/self', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ë‚´ê²Œ ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ë‚´ê²Œ ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ë‚´ê²Œ ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function getReceivedEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/receive', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ë°›ì€ ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ë°›ì€ ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ë°›ì€ ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function getSentEmails() {
            try {
                const response = await fetch('http://localhost:8089/mails/send', {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì„±ê³µ(ì½˜ì†”ì— ë°ì´í„° í™•ì¸)');
                    const data = await response.json();
                    console.log(data);
                } else {
                    alert('ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("ë³´ë‚¸ ë©”ì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }


        async function getFile() {
            const emailId = document.getElementById("emailId").value;
            const fileName = document.getElementById("fileName").value;

            try {
                const response = await fetch(`http://localhost:8089/mails/${emailId}/file/${fileName}`, {
                    method: "GET",
                    credentials: "include",
                    headers: {
                        Authorization: accessToken,
                    }
                })
                if (response.ok) {
                    alert('íŒŒì¼ ìˆ˜ì‹  ì„±ê³µ');
                } else {
                    alert('íŒŒì¼ ìˆ˜ì‹  ì‹¤íŒ¨');
                }
            } catch (error) {
                alert("íŒŒì¼ ìˆ˜ì‹  ì¤‘ ì˜¤ë¥˜ ë°œìƒ")
            }
        }

        async function storeFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                const response = await fetch('http://localhost:8089/fileUploadSample', {
                    method: 'POST',
                    headers: {
                        Authorization: accessToken,
                    },
                    body: formData,
                    credentials: "include"
                });

                if (response.ok) {
                    alert('íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ');
                } else {
                    alert('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('íŒŒì¼ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
            }
        }

        function getHello() {
            fetch("http://localhost:8089/hello", {
                method: "GET",
                credentials: "include",
                headers: {
                    Authorization: accessToken,
                }
            })
                .then(res => res.json())
                .then(data => {
                    console.log(data)
                    alert(JSON.stringify(data))
                })
        }

        function refresh() {
            fetch("http://localhost:8089/oauth2/reissue", {
                method: "POST",
                credentials: "include"
            })
                .then(res => {
                    if (res.status === 200) {
                        alert("refresh done!")
                        accessToken = res.headers.get("Authorization");
                    } else {
                        alert("refresh fail..")
                    }
                })
        }

        function storeUserInfo() {
            fetch("http://localhost:8089/users/info/student", {
                method: "post",
                credentials: "include",
                headers: {
                    Authorization: accessToken,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    studentDepartment: "ì»´í“¨í„°ê³µí•™ë¶€",
                    studentNum: 201901630
                })
            }).then(res => {
                if (res.status === 200) {
                    alert('save success!')
                } else {
                    alert('save fail...')
                }
            })
                .catch(error => alert(error))
        }

        function storeWorkerInfo() {
            fetch("http://localhost:8089/users/info/worker", {
                method: "post",
                credentials: "include",
                headers: {
                    Authorization: accessToken,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    "company": "ì¹´ì¹´ì˜¤",
                    "workerDepartment": "ê°œë°œ",
                    "position": "ëŒ€ë¦¬"
                })
            }).then(res => {
                if (res.status === 200) {
                    alert('save success!')
                } else {
                    alert('save fail...')
                }
            })
        }

        function logout() {
            fetch("http://localhost:8089/oauth2/logout", {
                method: "post",
                credentials: "include",
                headers: {
                    Authorization: accessToken
                }
            }).then(res => {
                if (res.status === 200) {
                    alert("logout success!")
                    window.location.href = "http://localhost:5500/testLoginPage.html"
                }
            })
        }

    async function sendEmail() {
        const toEmail = document.getElementById("toEmail").value;
        const subject = document.getElementById("subject").value;
        const body = document.getElementById("body").value;

        try {
            const response = await fetch('http://localhost:8089/mails/send', {
                method: "POST",
                credentials: "include",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: accessToken,
                },
                body: JSON.stringify({
                    toEmail: toEmail,
                    subject: subject,
                    body: body
                })
            });

            if (response.ok) {
                alert('ğŸ“© ë©”ì¼ ì „ì†¡ ì„±ê³µ!');
            } else {
                alert('âŒ ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨');
            }
        } catch (error) {
            alert("âš  ë©”ì¼ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ");
        }
    }
    </script>
</body>

</html>